#!/bin/bash

function pingSweep()
{
	exec > >(tee -a pingsweep.log) 2>&1
	local base="onyxnode"
	local found=0
	local total=0
	for q in {1..200}
	do
		local curr="${base}${q}"
		if ping -c 1 -W 1 "${curr}" &> /dev/null; then
			echo "Node ${curr} is reachable."
			((found++))
		else
			echo "Node ${curr} is not reachable."
		fi
		((total++))
	done
	echo "Sweep complete: ${found}/${total} nodes reachable."
}

function usage()
{
	echo "Usage: $0 [Options]"
	echo
	echo "Ping sweep Onyx Nodes"
	echo
	echo "Options:"
	echo "-h	Show help message and exit"
	echo "-p 	Run pingsweep"
	echo
}

function main() {
	while getopts ":hp" opt; do
		case ${opt} in 
			h) usage ;;
			p) pingSweep ;;
			/?)
				echo "Invalid option: -$OPTARG" >&2
				usage
				;;
		esac
	done
	shift $((OPTIND -1))
}

if [ $# -eq 0 ]; then
	usage
	exit 0
else
	main "$@"	
fi
	
